<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–µ—Ä–º–∞: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #e0f7fa;
            color: #333;
        }
        #menu, #game {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #farm {
            min-height: 300px;
            margin: 20px 0;
            padding: 15px;
            background-color: #81C784;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        .farm-object {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }
        .plant {
            border-radius: 50%;
        }
        .animal {
            font-size: 24px;
        }
        .stats {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        .stat-item {
            margin: 5px 10px;
        }
        .tab {
            display: none;
        }
        .active-tab {
            display: block;
        }
        #tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .tab-btn {
            background-color: #ddd;
            color: #333;
            margin: 3px;
        }
        .tab-btn.active {
            background-color: #4CAF50;
            color: white;
        }
        .level-locked {
            filter: grayscale(100%);
            opacity: 0.7;
        }
        .quest {
            background-color: #e3f2fd;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            text-align: left;
        }
        .quest.completed {
            background-color: #c8e6c9;
        }
        .progress-bar {
            height: 5px;
            background-color: #ddd;
            margin-top: 5px;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
        }
        #shop-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .shop-item {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 5px;
            width: 120px;
        }
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 3px 5px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .xp-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            width: 0%;
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="menu">
        <h1>–§–µ—Ä–º–∞: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</h1>
        <div class="stats">
            <div class="stat-item">–£—Ä–æ–≤–µ–Ω—å: <span id="player-level">1</span></div>
            <div class="stat-item">–û–ø—ã—Ç: <span id="player-xp">0</span>/<span id="player-max-xp">100</span></div>
            <div class="stat-item">–ú–æ–Ω–µ—Ç—ã: <span id="total-coins">0</span> ü™ô</div>
        </div>
        <div class="xp-bar">
            <div class="xp-progress" id="xp-bar"></div>
        </div>
        <button id="start-game">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É</button>
        <button id="reset-game">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="game" class="tab">
        <div id="tabs">
            <button class="tab-btn active" data-tab="farm-tab">–§–µ—Ä–º–∞</button>
            <button class="tab-btn" data-tab="shop-tab">–ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="tab-btn" data-tab="quests-tab">–ó–∞–¥–∞–Ω–∏—è</button>
            <button class="tab-btn" data-tab="stats-tab">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </div>

        <div id="farm-tab" class="active-tab tab">
            <h2>–§–µ—Ä–º–∞ (<span id="current-level">1</span> —É—Ä–æ–≤–µ–Ω—å)</h2>
            <div id="farm"></div>
            
            <div class="stats">
                <div class="stat-item">ü™ô: <span id="coins">50</span></div>
                <div class="stat-item">üåæ: <span id="wheat">0</span></div>
                <div class="stat-item">ü•ö: <span id="eggs">0</span></div>
                <div class="stat-item">ü•õ: <span id="milk">0</span></div>
            </div>
            
            <div id="action-buttons">
                <button id="carrot-btn" data-cost="10">ü•ï –ú–æ—Ä–∫–æ–≤—å (10ü™ô)</button>
                <button id="wheat-btn" data-cost="15">üåæ –ü—à–µ–Ω–∏—Ü–∞ (15ü™ô)</button>
                <button id="chicken-btn" data-cost="30" data-limit="3">üêî –ö—É—Ä–∏—Ü–∞ (30ü™ô)</button>
            </div>
            <button id="sell-btn">üí∞ –ü—Ä–æ–¥–∞—Ç—å —É—Ä–æ–∂–∞–π</button>
            <button id="menu-btn">–í –º–µ–Ω—é</button>
        </div>

        <div id="shop-tab" class="tab">
            <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
            <div class="stats">
                <div class="stat-item">ü™ô: <span id="shop-coins">50</span></div>
                <div class="stat-item">–£—Ä–æ–≤–µ–Ω—å: <span id="shop-level">1</span></div>
            </div>
            
            <div id="shop-items">
                <div class="shop-item">
                    <h3>–ö–æ—Ä–æ–≤–∞</h3>
                    <p>–î–∞—ë—Ç –º–æ–ª–æ–∫–æ</p>
                    <p>–¶–µ–Ω–∞: 100ü™ô</p>
                    <p>–¢—Ä–µ–±—É–µ—Ç—Å—è: 2 —É—Ä–æ–≤–µ–Ω—å</p>
                    <button class="buy-btn" data-item="cow" data-cost="100" data-level="2">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <h3>–°–≤–∏–Ω—å—è</h3>
                    <p>–î–∞—ë—Ç –±–µ–∫–æ–Ω</p>
                    <p>–¶–µ–Ω–∞: 150ü™ô</p>
                    <p>–¢—Ä–µ–±—É–µ—Ç—Å—è: 3 —É—Ä–æ–≤–µ–Ω—å</p>
                    <button class="buy-btn" data-item="pig" data-cost="150" data-level="3">–ö—É–ø–∏—Ç—å</button>
                </div>
                <div class="shop-item">
                    <h3>–§—Ä—É–∫—Ç–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ</h3>
                    <p>–î–∞—ë—Ç —Ñ—Ä—É–∫—Ç—ã</p>
                    <p>–¶–µ–Ω–∞: 200ü™ô</p>
                    <p>–¢—Ä–µ–±—É–µ—Ç—Å—è: 4 —É—Ä–æ–≤–µ–Ω—å</p>
                    <button class="buy-btn" data-item="tree" data-cost="200" data-level="4">–ö—É–ø–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="quests-tab" class="tab">
            <h2>–ó–∞–¥–∞–Ω–∏—è</h2>
            <div id="quests-list">
                <div class="quest" data-quest="harvest-carrots" data-target="10" data-reward="50">
                    <h3>–°–æ–±–µ—Ä–∏—Ç–µ 10 –º–æ—Ä–∫–æ–≤–æ–∫</h3>
                    <p>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span class="progress-text">0/10</span></p>
                    <p>–ù–∞–≥—Ä–∞–¥–∞: 50ü™ô + 20XP</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quest" data-quest="harvest-wheat" data-target="5" data-reward="40">
                    <h3>–°–æ–±–µ—Ä–∏—Ç–µ 5 –ø—à–µ–Ω–∏—Ü—ã</h3>
                    <p>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span class="progress-text">0/5</span></p>
                    <p>–ù–∞–≥—Ä–∞–¥–∞: 40ü™ô + 15XP</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quest" data-quest="collect-eggs" data-target="20" data-reward="100">
                    <h3>–°–æ–±–µ—Ä–∏—Ç–µ 20 —è–∏—Ü</h3>
                    <p>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span class="progress-text">0/20</span></p>
                    <p>–ù–∞–≥—Ä–∞–¥–∞: 100ü™ô + 30XP</p>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="stats-tab" class="tab">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stats">
                <div class="stat-item">–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <span id="stat-earned">0</span> ü™ô</div>
                <div class="stat-item">–°–æ–±—Ä–∞–Ω–æ –º–æ—Ä–∫–æ–≤–∏: <span id="stat-carrots">0</span> ü•ï</div>
                <div class="stat-item">–°–æ–±—Ä–∞–Ω–æ –ø—à–µ–Ω–∏—Ü—ã: <span id="stat-wheat">0</span> üåæ</div>
                <div class="stat-item">–°–æ–±—Ä–∞–Ω–æ —è–∏—Ü: <span id="stat-eggs">0</span> ü•ö</div>
                <div class="stat-item">–°–æ–±—Ä–∞–Ω–æ –º–æ–ª–æ–∫–∞: <span id="stat-milk">0</span> ü•õ</div>
                <div class="stat-item">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π: <span id="stat-quests">0</span></div>
                <div class="stat-item">–í—Ä–µ–º—è –∏–≥—Ä—ã: <span id="stat-time">0</span> –º–∏–Ω</div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const gameState = {
            coins: 50,
            inventory: {
                wheat: 0,
                carrots: 0,
                eggs: 0,
                milk: 0,
                bacon: 0,
                fruits: 0
            },
            objects: {
                carrots: [],
                wheat: [],
                chickens: [],
                cows: [],
                pigs: [],
                trees: []
            },
            stats: {
                totalEarned: 0,
                harvestedCarrots: 0,
                harvestedWheat: 0,
                collectedEggs: 0,
                collectedMilk: 0,
                completedQuests: 0,
                playTime: 0
            },
            player: {
                level: 1,
                xp: 0,
                maxXp: 100
            },
            quests: {
                'harvest-carrots': { progress: 0, completed: false },
                'harvest-wheat': { progress: 0, completed: false },
                'collect-eggs': { progress: 0, completed: false }
            },
            limits: {
                chickens: 3,
                cows: 2,
                pigs: 2,
                trees: 1
            },
            prices: {
                carrot: 10,
                wheat: 15,
                chicken: 30,
                cow: 100,
                pig: 150,
                tree: 200
            },
            lastUpdate: Date.now()
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const menuScreen = document.getElementById('menu');
        const gameScreen = document.getElementById('game');
        const farmArea = document.getElementById('farm');
        const notification = document.getElementById('notification');
        let gameInterval;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            loadGame();
            setupEventListeners();
            updateUI();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            gameInterval = setInterval(gameLoop, 1000);
        }

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            const now = Date.now();
            const deltaTime = (now - gameState.lastUpdate) / 1000; // –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            gameState.lastUpdate = now;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏–≥—Ä—ã (–≤ –º–∏–Ω—É—Ç–∞—Ö)
            gameState.stats.playTime += deltaTime / 60;
            
            // –ö—É—Ä–∏—Ü—ã –Ω–µ—Å—É—Ç —è–π—Ü–∞
            gameState.objects.chickens.forEach(chicken => {
                chicken.timeSinceLastEgg += deltaTime;
                if (chicken.timeSinceLastEgg >= 15) { // –ö–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
                    gameState.inventory.eggs++;
                    gameState.stats.collectedEggs++;
                    chicken.timeSinceLastEgg = 0;
                    updateQuestProgress('collect-eggs', 1);
                    updateUI();
                }
            });
            
            // –ö–æ—Ä–æ–≤—ã –¥–∞—é—Ç –º–æ–ª–æ–∫–æ
            gameState.objects.cows.forEach(cow => {
                cow.timeSinceLastMilk += deltaTime;
                if (cow.timeSinceLastMilk >= 30) { // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                    gameState.inventory.milk++;
                    gameState.stats.collectedMilk++;
                    cow.timeSinceLastMilk = 0;
                    updateUI();
                }
            });
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            if (gameState.stats.playTime % 0.5 < deltaTime / 60) {
                saveGame();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const savedGame = localStorage.getItem('farmGameSave');
            if (savedGame) {
                const parsed = JSON.parse(savedGame);
                Object.assign(gameState, parsed);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –Ω–∞ —Ñ–µ—Ä–º–µ
                restoreFarmObjects();
                
                updateUI();
                showNotification('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            const saveData = {
                coins: gameState.coins,
                inventory: gameState.inventory,
                stats: gameState.stats,
                player: gameState.player,
                quests: gameState.quests,
                objects: {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    carrots: gameState.objects.carrots.map(c => ({ x: c.x, y: c.y, isReady: c.isReady })),
                    wheat: gameState.objects.wheat.map(w => ({ x: w.x, y: w.y, isReady: w.isReady })),
                    chickens: gameState.objects.chickens.map(ch => ({ x: ch.x, y: ch.y, timeSinceLastEgg: ch.timeSinceLastEgg })),
                    cows: gameState.objects.cows.map(cow => ({ x: cow.x, y: cow.y, timeSinceLastMilk: cow.timeSinceLastMilk })),
                    pigs: gameState.objects.pigs.map(pig => ({ x: pig.x, y: pig.y })),
                    trees: gameState.objects.trees.map(tree => ({ x: tree.x, y: tree.y }))
                }
            };
            
            localStorage.setItem('farmGameSave', JSON.stringify(saveData));
        }

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ —Ñ–µ—Ä–º–µ
        function restoreFarmObjects() {
            // –û—á–∏—â–∞–µ–º —Ñ–µ—Ä–º—É
            farmArea.innerHTML = '';
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ—Ä–∫–æ–≤—å
            gameState.objects.carrots.forEach(carrot => {
                createPlant('carrot', carrot.x, carrot.y, carrot.isReady);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—à–µ–Ω–∏—Ü—É
            gameState.objects.wheat.forEach(wheat => {
                createPlant('wheat', wheat.x, wheat.y, wheat.isReady);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—É—Ä–∏—Ü
            gameState.objects.chickens.forEach(chicken => {
                createAnimal('chicken', chicken.x, chicken.y);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ—Ä–æ–≤
            gameState.objects.cows.forEach(cow => {
                createAnimal('cow', cow.x, cow.y);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤–∏–Ω–µ–π
            gameState.objects.pigs.forEach(pig => {
                createAnimal('pig', pig.x, pig.y);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–µ—Ä–µ–≤—å—è
            gameState.objects.trees.forEach(tree => {
                createPlant('tree', tree.x, tree.y, true);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Ç–µ–Ω–∏—è
        function addPlant(type) {
            const cost = gameState.prices[type];
            
            if (gameState.coins < cost) {
                showNotification(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ ${cost}ü™ô`);
                return;
            }
            
            gameState.coins -= cost;
            const x = Math.random() * 80 + 10;
            const y = Math.random() * 60 + 20;
            
            const plant = {
                type: type,
                x: x,
                y: y,
                isReady: false,
                element: null
            };
            
            gameState.objects[type + 's'].push(plant);
            createPlant(type, x, y, false);
            
            // –í—Ä–µ–º—è —Ä–æ—Å—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è
            let growTime;
            switch(type) {
                case 'carrot': growTime = 20; break;
                case 'wheat': growTime = 30; break;
                case 'tree': growTime = 60; break;
                default: growTime = 20;
            }
            
            // –†–∞—Å—Ç–µ–Ω–∏–µ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–æ —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            setTimeout(() => {
                plant.isReady = true;
                if (plant.element) {
                    plant.element.style.transform = 'scale(1.1)';
                    plant.element.style.filter = 'brightness(1.1)';
                }
            }, growTime * 1000);
            
            updateUI();
        }

        function createPlant(type, x, y, isReady) {
            const plantEl = document.createElement('div');
            plantEl.className = `farm-object plant ${type}`;
            plantEl.style.left = `${x}%`;
            plantEl.style.top = `${y}%`;
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è
            let emoji, color;
            switch(type) {
                case 'carrot':
                    emoji = 'ü•ï';
                    color = '#FF8C00';
                    break;
                case 'wheat':
                    emoji = 'üåæ';
                    color = '#DAA520';
                    break;
                case 'tree':
                    emoji = 'üå≥';
                    color = '#228B22';
                    break;
                default:
                    emoji = 'üå±';
                    color = '#4CAF50';
            }
            
            plantEl.textContent = emoji;
            plantEl.style.color = color;
            plantEl.style.fontSize = type === 'tree' ? '30px' : '24px';
            plantEl.style.transform = isReady ? 'scale(1.1)' : 'scale(0.7)';
            plantEl.style.filter = isReady ? 'brightness(1.1)' : 'brightness(0.7)';
            
            plantEl.addEventListener('click', () => {
                if (isReady) {
                    harvestPlant(plantEl, type);
                } else {
                    showNotification(`–ï—â—ë –Ω–µ —Å–æ–∑—Ä–µ–ª–æ!`);
                }
            });
            
            farmArea.appendChild(plantEl);
            return plantEl;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
        function addAnimal(type) {
            const cost = gameState.prices[type];
            const limit = gameState.limits[type + 's'];
            
            if (gameState.coins < cost) {
                showNotification(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ ${cost}ü™ô`);
                return;
            }
            
            if (gameState.objects[type + 's'].length >= limit) {
                showNotification(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –¥–ª—è ${getAnimalName(type)} (${limit})`);
                return;
            }
            
            if (gameState.player.level < getRequiredLevel(type)) {
                showNotification(`–¢—Ä–µ–±—É–µ—Ç—Å—è ${getRequiredLevel(type)} —É—Ä–æ–≤–µ–Ω—å`);
                return;
            }
            
            gameState.coins -= cost;
            const x = Math.random() * 80 + 10;
            const y = Math.random() * 60 + 20;
            
            const animal = {
                type: type,
                x: x,
                y: y,
                timeSinceLastEgg: 0,
                timeSinceLastMilk: 0,
                element: null
            };
            
            gameState.objects[type + 's'].push(animal);
            createAnimal(type, x, y);
            
            updateUI();
        }

        function getAnimalName(type) {
            const names = {
                'chicken': '–∫—É—Ä–∏—Ü',
                'cow': '–∫–æ—Ä–æ–≤',
                'pig': '—Å–≤–∏–Ω–µ–π',
                'tree': '–¥–µ—Ä–µ–≤—å–µ–≤'
            };
            return names[type] || type;
        }

        function getRequiredLevel(type) {
            const levels = {
                'chicken': 1,
                'cow': 2,
                'pig': 3,
                'tree': 4
            };
            return levels[type] || 1;
        }

        function createAnimal(type, x, y) {
            const animalEl = document.createElement('div');
            animalEl.className = `farm-object animal ${type}`;
            animalEl.style.left = `${x}%`;
            animalEl.style.top = `${y}%`;
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ
            let emoji;
            switch(type) {
                case 'chicken': emoji = 'üêî'; break;
                case 'cow': emoji = 'üêÑ'; break;
                case 'pig': emoji = 'üêñ'; break;
                default: emoji = 'üêæ';
            }
            
            animalEl.textContent = emoji;
            animalEl.style.fontSize = '24px';
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
            let directionX = Math.random() > 0.5 ? 1 : -1;
            let directionY = Math.random() > 0.5 ? 1 : -1;
            const speed = 0.2;
            
            const moveInterval = setInterval(() => {
                const currentX = parseFloat(animalEl.style.left);
                const currentY = parseFloat(animalEl.style.top);
                
                let newX = currentX + directionX * speed;
                let newY = currentY + directionY * speed * 0.5;
                
                if (newX < 5 || newX > 95) directionX *= -1;
                if (newY < 10 || newY > 80) directionY *= -1;
                
                animalEl.style.left = `${newX}%`;
                animalEl.style.top = `${newY}%`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∏–≥—Ä—ã
                const animal = gameState.objects[type + 's'].find(a => a.element === animalEl);
                if (animal) {
                    animal.x = newX;
                    animal.y = newY;
                }
            }, 100);
            
            farmArea.appendChild(animalEl);
            return animalEl;
        }

        // –°–±–æ—Ä —É—Ä–æ–∂–∞—è
        function harvestPlant(plantEl, type) {
            let reward = 0;
            
            switch(type) {
                case 'carrot':
                    gameState.inventory.carrots++;
                    gameState.stats.harvestedCarrots++;
                    reward = 5;
                    updateQuestProgress('harvest-carrots', 1);
                    break;
                case 'wheat':
                    gameState.inventory.wheat++;
                    gameState.stats.harvestedWheat++;
                    reward = 7;
                    updateQuestProgress('harvest-wheat', 1);
                    break;
                case 'tree':
                    gameState.inventory.fruits++;
                    reward = 15;
                    break;
            }
            
            // –£–¥–∞–ª—è–µ–º —Ä–∞—Å—Ç–µ–Ω–∏–µ –∏–∑ –º–∞—Å—Å–∏–≤–∞
            gameState.objects[type + 's'] = gameState.objects[type + 's'].filter(p => p.element !== plantEl);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞
            plantEl.style.transform = 'scale(1.5)';
            plantEl.style.opacity = '0';
            setTimeout(() => {
                plantEl.remove();
            }, 300);
            
            // –ù–∞–≥—Ä–∞–¥–∞
            gameState.coins += reward;
            gameState.stats.totalEarned += reward;
            addXP(10);
            
            showNotification(`+${reward}ü™ô`);
            updateUI();
        }

        // –ü—Ä–æ–¥–∞–∂–∞ —É—Ä–æ–∂–∞—è
        function sellHarvest() {
            let total = 0;
            
            // –¶–µ–Ω—ã –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
            const prices = {
                wheat: 3,
                carrots: 4,
                eggs: 2,
                milk: 5,
                bacon: 7,
                fruits: 6
            };
            
            // –ü—Ä–æ–¥–∞–µ–º –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã
            for (const [item, amount] of Object.entries(gameState.inventory)) {
                if (amount > 0 && prices[item]) {
                    total += amount * prices[item];
                    gameState.inventory[item] = 0;
                }
            }
            
            if (total === 0) {
                showNotification('–ù–µ—á–µ–≥–æ –ø—Ä–æ–¥–∞–≤–∞—Ç—å!');
                return;
            }
            
            gameState.coins += total;
            gameState.stats.totalEarned += total;
            addXP(15);
            
            showNotification(`–ü—Ä–æ–¥–∞–Ω–æ –Ω–∞ ${total}ü™ô`);
            updateUI();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞
        function addXP(amount) {
            gameState.player.xp += amount;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è
            if (gameState.player.xp >= gameState.player.maxXp) {
                gameState.player.xp -= gameState.player.maxXp;
                gameState.player.level++;
                gameState.player.maxXp = Math.floor(gameState.player.maxXp * 1.5);
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç—ã —Å —É—Ä–æ–≤–Ω–µ–º
                gameState.limits.chickens = 3 + Math.floor(gameState.player.level / 2);
                gameState.limits.cows = 2 + Math.floor(gameState.player.level / 3);
                
                showNotification(`–£—Ä–æ–≤–µ–Ω—å ${gameState.player.level}!`, 3000);
            }
            
            updateUI();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–¥–∞–Ω–∏—è
        function updateQuestProgress(questId, amount) {
            if (gameState.quests[questId].completed) return;
            
            gameState.quests[questId].progress += amount;
            const questData = document.querySelector(`.quest[data-quest="${questId}"]`);
            const target = parseInt(questData.getAttribute('data-target'));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const progressText = questData.querySelector('.progress-text');
            const progressBar = questData.querySelector('.progress');
            
            progressText.textContent = `${gameState.quests[questId].progress}/${target}`;
            progressBar.style.width = `${Math.min(100, gameState.quests[questId].progress / target * 100)}%`;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
            if (gameState.quests[questId].progress >= target) {
                gameState.quests[questId].completed = true;
                questData.classList.add('completed');
                
                const reward = parseInt(questData.getAttribute('data-reward'));
                gameState.coins += reward;
                gameState.stats.totalEarned += reward;
                addXP(20);
                gameState.stats.completedQuests++;
                
                showNotification(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${reward}ü™ô +20XP`, 3000);
                updateUI();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // –ú–µ–Ω—é
            document.getElementById('player-level').textContent = gameState.player.level;
            document.getElementById('player-xp').textContent = gameState.player.xp;
            document.getElementById('player-max-xp').textContent = gameState.player.maxXp;
            document.getElementById('total-coins').textContent = gameState.stats.totalEarned;
            document.getElementById('xp-bar').style.width = `${gameState.player.xp / gameState.player.maxXp * 100}%`;
            
            // –ò–≥—Ä–∞
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('wheat').textContent = gameState.inventory.wheat;
            document.getElementById('carrots').textContent = gameState.inventory.carrots;
            document.getElementById('eggs').textContent = gameState.inventory.eggs;
            document.getElementById('milk').textContent = gameState.inventory.milk;
            document.getElementById('current-level').textContent = gameState.player.level;
            
            // –ú–∞–≥–∞–∑–∏–Ω
            document.getElementById('shop-coins').textContent = gameState.coins;
            document.getElementById('shop-level').textContent = gameState.player.level;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('stat-earned').textContent = gameState.stats.totalEarned;
            document.getElementById('stat-carrots').textContent = gameState.stats.harvestedCarrots;
            document.getElementById('stat-wheat').textContent = gameState.stats.harvestedWheat;
            document.getElementById('stat-eggs').textContent = gameState.stats.collectedEggs;
            document.getElementById('stat-milk').textContent = gameState.stats.collectedMilk;
            document.getElementById('stat-quests').textContent = gameState.stats.completedQuests;
            document.getElementById('stat-time').textContent = Math.floor(gameState.stats.playTime);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
            updateButtonsAvailability();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–æ–∫
        function updateButtonsAvailability() {
            // –ö–Ω–æ–ø–∫–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π
            document.getElementById('carrot-btn').disabled = gameState.coins < gameState.prices.carrot;
            document.getElementById('wheat-btn').disabled = gameState.coins < gameState.prices.wheat;
            
            // –ö–Ω–æ–ø–∫–∏ –∂–∏–≤–æ—Ç–Ω—ã—Ö
            document.getElementById('chicken-btn').disabled = 
                gameState.coins < gameState.prices.chicken || 
                gameState.objects.chickens.length >= gameState.limits.chickens;
            
            // –ö–Ω–æ–ø–∫–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
            document.querySelectorAll('.buy-btn').forEach(btn => {
                const item = btn.getAttribute('data-item');
                const cost = parseInt(btn.getAttribute('data-cost'));
                const requiredLevel = parseInt(btn.getAttribute('data-level'));
                
                btn.disabled = 
                    gameState.coins < cost || 
                    gameState.player.level < requiredLevel ||
                    (gameState.objects[item + 's'] && 
                     gameState.objects[item + 's'].length >= gameState.limits[item + 's']);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, duration = 2000) {
            notification.textContent = message;
            notification.style.opacity = '1';
            
            setTimeout(() => {
                notification.style.opacity = '0';
            }, duration);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
            document.getElementById('start-game').addEventListener('click', () => {
                menuScreen.style.display = 'none';
                gameScreen.style.display = 'block';
            });
            
            document.getElementById('reset-game').addEventListener('click', () => {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω!')) {
                    localStorage.removeItem('farmGameSave');
                    location.reload();
                }
            });
            
            // –ö–Ω–æ–ø–∫–∏ –∏–≥—Ä—ã
            document.getElementById('carrot-btn').addEventListener('click', () => addPlant('carrot'));
            document.getElementById('wheat-btn').addEventListener('click', () => addPlant('wheat'));
            document.getElementById('chicken-btn').addEventListener('click', () => addAnimal('chicken'));
            document.getElementById('sell-btn').addEventListener('click', sellHarvest);
            document.getElementById('menu-btn').addEventListener('click', () => {
                saveGame();
                menuScreen.style.display = 'block';
                gameScreen.style.display = 'none';
            });
            
            // –í–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active-tab'));
                    
                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active-tab');
                });
            });
            
            // –ö–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const item = this.getAttribute('data-item');
                    addAnimal(item);
                });
            });
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        initGame();
    </script>
</body>
</html>
